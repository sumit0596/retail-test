import{a as $}from"./chunk-B2JWDLBT.js";import{a as M}from"./chunk-CYK5HLCI.js";import{a as Q}from"./chunk-FJTDMGYD.js";import{a as H}from"./chunk-F2AWUHRW.js";import{a as W}from"./chunk-6ZT7OVEF.js";import{$ as P,ba as B}from"./chunk-FLJC444F.js";import{e as u,f as U,g as C,h as o,o as j,r as q}from"./chunk-IPZIKDLO.js";import{p as F}from"./chunk-TBJJFKUM.js";import{Fc as V,Gb as f,Qb as h,Rb as l,Sb as _,V as N,Wb as S,Yb as T,Z as b,Zb as m,a as g,ad as A,b as v,dc as I,ec as w,fc as D,g as y,ia as k,ib as p,jc as R,kd as O,m as L,nb as n,qa as c,ra as d,ub as x,zb as E}from"./chunk-4KZPWME3.js";var z=["nameCell"],J=["nameHeader"];function K(s,t){if(s&1){let e=S();h(0,"div",7)(1,"button",8),T("click",function(){c(e);let i=m();return d(i.createUser())}),R(2," Create User "),l()()}}function X(s,t){if(s&1){let e=S();h(0,"div")(1,"app-datatable",9),T("filterChanged",function(i){c(e);let a=m();return d(a.filterColumns(i))})("rowClicked",function(i){c(e);let a=m();return d(a.rowClicked(i))})("getTableData",function(i){c(e);let a=m();return d(a.tableData(i))})("rowBasedAction",function(i){c(e);let a=m();return d(a.rowActions(i))})("toolbarEvent",function(i){c(e);let a=m();return d(a.onToolbarClick(i))}),l()()}if(s&2){let e=m();p(),f("tableSettings",e.tableConfig)("columns",e.columns)("data",e.users)("totalCount",e.totalCount)}}function Y(s,t){s&1&&(h(0,"div"),_(1,"app-skeleton-loader",10),l())}var G=class s{constructor(t,e,r,i,a,Z,ee){this.router=t;this.loaderService=e;this.toasterService=r;this.commonService=i;this.listingService=a;this.commonStore=Z;this.cdr=ee}filterData;tableConfig;originalUsers=[];nameCellTemplate;nameHeaderTemplate;filterColumns;destroySubject=new L;columns=[];actions=[{}];filter={PageNo:1,PerPage:10,Search:void 0,SortBy:void 0,SortOrder:"Desc",RoleId:void 0};user$;users;totalCount;userDetails;roleList$;roleList;fields=[{type:"text",label:"First Name",name:"FirstName",placeholder:"Enter First Name",value:"",wrapperClass:"col-12 col-md-6",validators:{required:!0,pattern:C.ALPHABETS,maxLength:100},id:"firstname"},{type:"text",label:"Last Name",name:"LastName",placeholder:"Enter Last Name",value:"",wrapperClass:"col-12 col-md-6",validators:{required:!0,pattern:C.ALPHABETS,maxLength:100},id:"lastname"},{type:"email",label:"Email",name:"Email",placeholder:"Enter Email Address",value:"",wrapperClass:"col-12 col-md-6",id:"email",validators:{required:!0,email:!0}},{type:"tel",label:"Cell number",name:"CellNumber",placeholder:"Enter contact number",value:"",wrapperClass:"col-12 col-md-6",id:"cellnumber",validators:{required:!0,pattern:C.NUMERIC_PLUS_SPACE_PATTERN}},{type:"select",label:"Roles",name:"RoleId",bindLabel:"Name",bindValue:"Id",value:"",options:this.roleList,id:"roles",validators:{required:!0},wrapperClass:"col-12 col-md-6",placeholder:"Select Role"}];formConfig;userStore=k(j);backUrl=u.ALL_USERS;userlistUrl=u.MANAGE_USER;access=!1;ngOnInit(){this.getCurrentUser(),this.getColumns()}getColumns(){this.columns=[{key:"FirstName",title:"First Name",sortable:!0,filterable:!0,filterType:"text",filterOptions:[{value:"",label:""},{value:"any",label:""}],width:"15%",cellTemplate:this.nameCellTemplate,headerTemplate:this.nameHeaderTemplate,showColumn:!0,visible:!0},{key:"LastName",title:"Last Name",sortable:!0,filterable:!0,width:"15%",showColumn:!0,visible:!0},{key:"Email",title:"Email",sortable:!0,width:"20%",showColumn:!0,visible:!0},{key:"RoleName",title:"Role Name",sortable:!0,width:"20%",showColumn:!0,visible:!0},{key:"CellNumber",title:"Cell Number",sortable:!0,width:"15%",showColumn:!0,visible:!0},{key:"LastLogin",title:"Last Login	",sortable:!0,width:"15%",showColumn:!0,visible:!0},{key:"actions",title:"Actions",width:"10%",sortable:!1,showColumn:!0,visible:!0}],this.initializeTable(),this.cdr.markForCheck(),this.loadTableData(this.filter)}getCurrentUser(){return y(this,null,function*(){this.user$=yield this.userStore.getUser(),this.user$.pipe(b(this.destroySubject)).subscribe(t=>{this.userDetails=t.User})})}createUser(){this.router.navigate([u.CREATE_USER])}getRoles(t){return y(this,null,function*(){return this.roleList&&this.roleList.length>0?this.roleList:(this.roleList$=yield this.listingService.getRoles(),this.roleList$.pipe(b(this.destroySubject),N(1)).subscribe({next:e=>{if(this.roleList=e,this.fields.forEach(r=>{r.type=="select"&&r.name=="RoleId"&&(r.options=this.roleList)}),t){let r=t.tools.find(i=>i.name=="Filter");r.fields&&r.fields.forEach(i=>{i.controlname=="RoleId"&&(i.options=this.roleList)})}},error:e=>{this.toasterService.error(e.error.message)}}),this.roleList)})}initializeTable(){this.tableConfig={id:"users",tablename:"Users",columns:this.columns,rows:[],tools:[{name:"Search",id:"search",disabled:!1,icon:"assets/images/search.svg"},{name:"Filter",id:"filter",disabled:!1,icon:"assets/images/filter.svg",fields:[{type:"select",id:"role",label:"Role",controlname:"RoleId",placeholder:"Select Role",bindLabel:"Name",bindValue:"Id",validators:{required:!0},multiselect:!1,checkbox:!1,options:[],value:""}]},{name:"Column",id:"column",disabled:!1,icon:"assets/images/grid-columns.svg"},{name:"Export",id:"export",disabled:!1,icon:"assets/images/download.svg"}],totalRowsCount:0,pageCnt:0,isPaginationRequired:!0,showActions:!0,isSearchRequired:!0,isColumnGroupRequired:!0,isDownloadRequired:!0,isFilterRequired:!0}}loadTableData(t){this.commonService.getData(U.GET_USERS,t).pipe(b(this.destroySubject)).subscribe({next:e=>{this.totalCount=e.totalUsers,this.users=e.users,this.userDetails=e,this.createTableConfig(e)},error:e=>{}})}createTableConfig(t){this.tableConfig=v(g({},this.tableConfig),{rows:t.users.map(e=>v(g({},e),{operations:t.FullAccess?[{name:o.VIEW.TITLE,icon:o.VIEW.ID,operationName:o.VIEW.ID,path:o.VIEW.ICON},{name:o.EDIT.TITLE,icon:o.EDIT.ID,operationName:o.EDIT.ID,path:o.EDIT.ICON},{name:o.DELETE.TITLE,icon:o.DELETE.ID,operationName:o.DELETE.ID,path:o.DELETE.ICON}]:[{name:o.VIEW.TITLE,icon:o.VIEW.ID,operationName:o.VIEW.ID,path:o.VIEW.ICON}]})),totalRowsCount:t.totalUsers,pageCnt:t.pageCount}),this.cdr.markForCheck()}tableData(t){this.filter={PageNo:t.pageNumber,PerPage:t.pageSize,Search:t.searchValue,SortBy:t.sortBy??void 0,SortOrder:t.sortOrder??void 0,RoleId:t.filters.RoleId??void 0},this.loadTableData(this.filter)}activeFilters={};resetFilters(){this.activeFilters={},this.users=[...this.originalUsers]}rowClicked(t){}onToolbarClick(t){let e=this.tableConfig.tools.find(r=>r.id=="filter"||r.name=="filter");e.fields&&e.fields.find(i=>i.controlname=="RoleId").options.length==0&&this.getRoles(this.tableConfig)}rowActions(t){switch(this.formConfig={module:"user",operation:t.operation,id:t.rowData.UserId},this.commonStore.setFormConfig(this.formConfig),t.operation){case o.EDIT.ID:this.router.navigate([u.EDIT_USER]);break;case o.VIEW.ID:this.router.navigate([u.VIEW_USER]);break;case o.DELETE.ID:this.deleteUser(t.rowData.UserId);break}}deleteUser(t){this.commonService.delete(`${U.DELETE_USER}/${t}`).subscribe({next:e=>{this.toasterService.success(e.message),this.loadTableData(this.filter)},error:e=>{e.error.errors?this.displayError(e.error.errors):this.toasterService.error(e.error.message)}})}displayError(t){let e=JSON.parse(t);Object.keys(e).forEach(r=>{this.toasterService.error(e[r][0])})}cancelUser(){this.router.navigate([`${u.MANAGE_USER}`])}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}static \u0275fac=function(e){return new(e||s)(n(F),n(q),n(P),n(B),n(M),n(Q),n(V))};static \u0275cmp=x({type:s,selectors:[["app-users"]],viewQuery:function(e,r){if(e&1&&(I(z,7),I(J,7)),e&2){let i;w(i=D())&&(r.nameCellTemplate=i.first),w(i=D())&&(r.nameHeaderTemplate=i.first)}},decls:10,vars:4,consts:[[1,"rd-container"],[1,"rd-container-header"],[1,"rd-container-header-left"],[3,"url"],[1,"rd-heading","rd-heading-lg"],["class","rd-container-header-right",4,"ngIf"],[4,"ngIf"],[1,"rd-container-header-right"],["type","button",1,"rd-btn-primary","rd-btn-lg",3,"click"],[3,"filterChanged","rowClicked","getTableData","rowBasedAction","toolbarEvent","tableSettings","columns","data","totalCount"],["type","datatable"]],template:function(e,r){e&1&&(h(0,"div",0)(1,"div",1)(2,"div",2)(3,"div"),_(4,"back-button",3),l(),h(5,"div",4),R(6,"Users"),l()(),E(7,K,3,0,"div",5),l(),E(8,X,2,4,"div",6)(9,Y,2,0,"div",6),l()),e&2&&(p(4),f("url",r.backUrl),p(3),f("ngIf",r.users&&(r.userDetails==null?null:r.userDetails.FullAccess)),p(),f("ngIf",r.users),p(),f("ngIf",!r.users))},dependencies:[O,A,$,H,W],encapsulation:2,changeDetection:0})};export{G as a};
