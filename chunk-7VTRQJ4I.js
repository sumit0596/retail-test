import{a as q}from"./chunk-CTLQS2KQ.js";import{a as J}from"./chunk-6ZT7OVEF.js";import{c as V}from"./chunk-5DBK4ZXR.js";import"./chunk-7IPKTMG7.js";import"./chunk-23ETMDCW.js";import"./chunk-FQU4EXR4.js";import"./chunk-7GNHLM6X.js";import{$ as M}from"./chunk-FLJC444F.js";import{c,g as f,n as h,o as H,p as a}from"./chunk-IPZIKDLO.js";import{f as k,p as A}from"./chunk-TBJJFKUM.js";import{$ as I,Fc as L,Gb as u,J as _,Qb as l,Rb as s,Sb as y,Tb as T,Ub as w,Wb as N,Yb as j,Zb as p,ad as O,ca as R,g as n,ha as x,ia as D,ib as d,jc as B,kd as $,n as U,nb as o,qa as S,ra as g,u as C,ub as F,x as E,zb as P}from"./chunk-4KZPWME3.js";var v=class i{constructor(t){this.http=t}rolesSubject=new U([]);roles$=this.rolesSubject.asObservable();storageService=D(h);deleteUser(t){let e=`${a.apiBaseUrl}/user/delete/${t}`;return this.http.delete(e)}postUserRegister(t){let e=`${a.apiBaseUrl}/user/register`;return this.http.post(e,t)}editUser(t,e){let r=`${a.apiBaseUrl}/user/update/${e}`;return this.http.put(r,t)}getUserById(t){let e=`${a.apiBaseUrl}/user/details/${t}`;return this.http.get(e)}getRoles(){return n(this,null,function*(){return yield this.loadRoles(),this.roles$})}loadRoles(){return n(this,null,function*(){let t=`${a.apiBaseUrl}/role/list`;this.http.get(t).pipe(E(r=>r.data),_(r=>C(()=>new r(r))),I(r=>{this.storageService.set(c.USER_ROLES,JSON.stringify(r)),this.rolesSubject.next(r)})).subscribe()})}static \u0275fac=function(e){return new(e||i)(x(k))};static \u0275prov=R({token:i,factory:i.\u0275fac,providedIn:"root"})};function K(i,t){if(i&1){let e=N();T(0),l(1,"app-dynamic-form",7),j("formSubmit",function(m){S(e);let b=p();return g(b.updateUser(m))})("formCancel",function(){S(e);let m=p();return g(m.goBack())}),s(),w()}if(i&2){let e=p();d(),u("fields",e.fields)("columns",e.createcolumns)("submitButtonText","Update Profile")("cancelButtonText","Cancel")}}function Q(i,t){i&1&&(l(0,"div"),y(1,"app-skeleton-loader",8),s())}var W=class i{constructor(t,e,r,m,b,X,Y){this.userservice=t;this.toasterService=e;this.router=r;this.userStore=m;this.loginService=b;this.cdr=X;this.storageService=Y}userDetails;userRoleId;userStatus;fields=this.buildFields();isLoaded=!1;createcolumns;ngOnInit(){this.router.url!=="/login"&&this.getUserDetails()}buildFields(){return[{type:"text",label:"First Name",name:"FirstName",placeholder:"Enter First Name",value:"",wrapperClass:"col-12 col-md-6",validators:{required:!0,pattern:f.ALPHABETS,maxLength:100},id:"firstname"},{type:"text",label:"Last Name",name:"LastName",placeholder:"Enter Last Name",value:"",wrapperClass:"col-12 col-md-6",validators:{required:!0,pattern:f.ALPHABETS,maxLength:100},id:"lastname"},{type:"email",label:"Email",name:"Email",placeholder:"Enter Email Address",value:"",wrapperClass:"col-12 col-md-6",id:"email",disabled:!0,validators:{required:!0,email:!0}},{type:"tel",label:"Cell number",name:"CellNumber",placeholder:"Enter contact number",value:"",wrapperClass:"col-12 col-md-6",id:"cellnumber",validators:{required:!0,pattern:f.NUMERIC_PLUS_SPACE_PATTERN}}]}getSessionUser(){let t=this.storageService.get(c.USER);if(!t)return null;try{return t}catch{return null}}getUserDetails(){let t=this.getSessionUser();if(!t?.User?.UserId){this.handleSessionError("Session expired or user not found. Please log in again.");return}this.userservice.getUserById(t.User.UserId).subscribe({next:e=>{this.userDetails=e.data,this.userRoleId=this.userDetails.RoleId??this.userDetails.User?.RoleId,this.userStatus=this.userDetails.Status??this.userDetails.User?.Status,this.patchFieldsWithUser(this.userDetails),this.isLoaded=!0,this.cdr.markForCheck(),this.createcolumns=[{value:this.fields}]},error:e=>{this.cdr.markForCheck(),this.toasterService.error("Error loading user details."),console.error("Error loading user details:",e)}})}patchFieldsWithUser(t){this.fields.forEach(e=>{e.name==="Email"&&(e.disabled=!0);let r=t[e.name];r===void 0&&t.User&&(r=t.User[e.name]),e.value=r??""}),this.fields=[...this.fields]}handleSessionError(t){this.toasterService.error(t),this.router.navigate(["/login"]),this.cdr.markForCheck()}goBack(){this.router.navigate(["/admin/dashboard"])}logout(t){return n(this,null,function*(){yield this.loginService.logout(),this.router.navigate(["login"]).then(()=>{this.toasterService.success(t.message)})})}updateUser(t){t.RoleId=this.userRoleId,t.Status=this.userStatus,this.userservice.editUser(t,this.userDetails.UserId).subscribe({next:e=>{if(e.data.Logout==1)this.logout(e);else{this.toasterService.success(e.message);let r=this.getSessionUser()??{};r.User=e.data.User??e.data,this.storageService.set(c.USER,JSON.stringify(r)),this.userStore.setUser(r)}},complete:()=>{},error:()=>{}})}static \u0275fac=function(e){return new(e||i)(o(v),o(M),o(A),o(H),o(q),o(L),o(h))};static \u0275cmp=F({type:i,selectors:[["app-profile-details"]],decls:10,vars:2,consts:[[1,"rd-container"],[1,"rd-container-header"],[1,"rd-container-header-left"],[1,"rd-heading","rd-heading-lg"],[1,"rd-container-header-right"],[1,"rd-container-body"],[4,"ngIf"],[3,"formSubmit","formCancel","fields","columns","submitButtonText","cancelButtonText"],["type","user-form"]],template:function(e,r){e&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),B(4,"My Profile"),s()(),y(5,"div",4),s(),l(6,"div")(7,"div",5),P(8,K,2,4,"ng-container",6)(9,Q,2,0,"div",6),s()()()),e&2&&(d(8),u("ngIf",r.createcolumns),d(),u("ngIf",!r.createcolumns))},dependencies:[$,O,V,J],encapsulation:2,changeDetection:0})};export{W as ProfileDetailsComponent};
