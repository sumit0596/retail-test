import{a as ce}from"./chunk-FJTDMGYD.js";import{a as de}from"./chunk-F2AWUHRW.js";import{a as le}from"./chunk-6ZT7OVEF.js";import{b as ae,c as me}from"./chunk-5DBK4ZXR.js";import"./chunk-7IPKTMG7.js";import"./chunk-23ETMDCW.js";import{b as Q,c as H,g as z,h as J,k as K,m as W,n as X,o as Y,p as Z,q as ee,r as te,u as ie,v as ne,w as re}from"./chunk-FQU4EXR4.js";import"./chunk-7GNHLM6X.js";import{$ as oe,ba as se}from"./chunk-FLJC444F.js";import{a as I,b as q,e as x,f as S,g as U}from"./chunk-IPZIKDLO.js";import{p as B}from"./chunk-TBJJFKUM.js";import{$c as j,Ac as D,Fc as V,Gb as m,Qb as o,Rb as s,Sb as g,Tb as O,Ub as k,Wb as b,Yb as P,Z as v,Zb as d,a as f,ad as $,b as h,dc as N,ec as L,fc as A,g as F,ib as a,ic as w,jc as c,kc as E,kd as G,m as M,nb as u,qa as C,ra as y,ub as T,zb as p}from"./chunk-4KZPWME3.js";var _e=["nameCell"];function ge(r,t){if(r&1){let e=b();o(0,"div")(1,"app-dynamic-form",7),P("formSubmit",function(n){C(e);let l=d(2);return y(l.onSubmit(n))})("formCancel",function(){C(e);let n=d(2);return y(n.goBack())}),s()()}if(r&2){let e=d(2),i=w(10);a(),m("fields",e.fields)("columns",e.createcolumns)("additionalColumn",i)("additionalForm",e.roleForm)}}function fe(r,t){if(r&1&&(o(0,"div"),p(1,ge,2,4,"div",6),s()),r&2){let e=d();a(),m("ngIf",e.createcolumns)}}function he(r,t){r&1&&(o(0,"div"),g(1,"app-skeleton-loader",8),s())}function Ce(r,t){r&1&&(o(0,"label",12),c(1,"Select Permissions "),o(2,"span",13),c(3,"*"),s()())}function ye(r,t){if(r&1&&(o(0,"div",19)(1,"small"),c(2),s()()),r&2){let e=d(3);a(2),E(e.permissions.errors==null?null:e.permissions.errors.invalid)}}function ve(r,t){r&1&&(o(0,"div",28),g(1,"input",29),s()),r&2&&(a(),m("value",0))}function be(r,t){if(r&1){let e=b();o(0,"tr",20)(1,"td",16)(2,"div",22)(3,"input",23),P("change",function(n){let l=C(e).index,_=d().$implicit,R=d(3);return y(R.onPermissionChange(n,"SUB",_,l))}),s()()(),o(4,"td")(5,"label",27),c(6),s()(),o(7,"td")(8,"div",28),g(9,"input",29),s()(),o(10,"td"),p(11,ve,2,1,"div",30),s()()}if(r&2){let e=t.$implicit,i=t.index,n=d().index,l=d(3);m("formGroupName",i),a(3),m("id","sub-permission-id"+n+i),a(2),m("for","sub-permission-id"+n+i),a(),E(e.value.Name),a(3),m("value",1),a(2),m("ngIf",l.mergedPermissionList[n].Name!="Dashboard")}}function Pe(r,t){if(r&1){let e=b();O(0,20),o(1,"tr",21)(2,"td")(3,"div",22)(4,"input",23),P("change",function(n){let l=C(e),_=l.$implicit,R=l.index,ue=d(3);return y(ue.onPermissionChange(n,"MAIN",_,R))}),s()()(),o(5,"td",24)(6,"label",25),c(7),s()()(),O(8,26),p(9,be,12,6,"tr",18),k()()}if(r&2){let e=t.$implicit,i=t.index,n=d(3);m("formGroupName",i),a(4),m("id","permission-id"+i),a(3),E(n.mergedPermissionList[i].Name),a(2),m("ngForOf",n.getSubPermission(e,i).controls)}}function Ee(r,t){if(r&1&&(o(0,"table",14)(1,"caption"),p(2,ye,3,1,"div",15),s(),o(3,"thead"),g(4,"th",16),o(5,"th"),c(6,"Permission"),s(),o(7,"th"),c(8,"Full Access"),s(),o(9,"th"),c(10,"Readonly"),s()(),o(11,"tbody",17),p(12,Pe,10,4,"ng-container",18),s()()),r&2){let e=d(2);a(2),m("ngIf",e.permissions==null?null:e.permissions.hasError("invalid")),a(10),m("ngForOf",e.permissions.controls)}}function xe(r,t){if(r&1&&(o(0,"form",9),p(1,Ce,4,0,"label",10)(2,Ee,13,2,"table",11),s()),r&2){let e=d();m("formGroup",e.roleForm),a(),m("ngIf",e.mergedPermissionList.length),a(),m("ngIf",e.mergedPermissionList.length)}}var pe=class r{constructor(t,e,i,n,l,_){this.router=t;this.commonService=e;this.toasterService=i;this.fb=n;this.commonStore=l;this.cdr=_}formConfig;roleForm;permissionList=[];selectedPermissionList=[];mergedPermissionList=[];role;submitted=!1;roleDetails;selectedCheckBox=0;getRoleId=0;createcolumns=[];fields=[];RoleId;isLoaded=!1;additionalColumn;destroy$=new M;rolelistUrl=x.MANAGE_ROLE;ngOnInit(){this.configureForm(),this.roleForm=this.fb.group({Permission:this.fb.array([],ae.permissionValidator)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}configureForm(){return F(this,null,function*(){this.formConfig=yield this.commonStore.getFormConfig(),this.formConfig.id&&(this.RoleId=this.formConfig.id,this.getPermissions())})}getRoleById(){let t=`${S.ROLE_DETAIL}/${this.RoleId}`;this.commonService.get(t).pipe(v(this.destroy$)).subscribe({next:e=>{this.getRoleId=e.data.RoleId,this.roleDetails=e.data,this.selectedPermissionList=e.data.Permission,this.bindPermission(),this.fields=[{type:"text",label:"Name",name:"Name",value:e.data.Name??"",id:"Name",wrapperClass:"col-md-12",disabled:!1,placeholder:"Enter First Name",required:!0,validators:{required:!0,pattern:U.ALPHABETS,maxLength:100,whitespace:!0}},{type:"textarea",label:"Description",name:"Description",value:e.data.Description??"",id:"Description",wrapperClass:"col-md-12",disabled:!1,placeholder:"Enter Description",required:!0,validators:{required:!0,whitespace:!0}}],this.createcolumns=[{id:"col-12 d-flex flex-wrap gap-3 justify-content-center",value:this.fields}],this.isLoaded=!0,this.cdr.markForCheck()},error:e=>{}})}get permissions(){return this.roleForm.get("Permission")}getPermissions(){return F(this,null,function*(){this.commonService.get(`${S.PERMISSION_LIST}`).pipe(v(this.destroy$)).subscribe({next:t=>{let e=t.data;if(e.length>0){let i=e[0].SubMenu.slice(0,1);e[0].SubMenu=i}this.permissionList=e,this.getRoleById(),this.cdr.markForCheck()},error:t=>{}})})}bindPermission(){this.mergedPermissionList=this.permissionList.map(t=>([...t.SubMenu].forEach(e=>{let i=this.selectedPermissionList.find(n=>n.PermissionId==e.PermissionId);i?Object.assign(e,{Checked:i.Checked,PermissionType:i.PermissionType}):Object.assign(e,{Checked:!1,PermissionType:""})}),t)),this.mergedPermissionList.forEach(t=>{this.permissions.push(this.createPermissionForm(t))})}createPermissionForm(t){let e=[...t.SubMenu].every(n=>n.Checked);return this.fb.group({Name:[t.Name],Checked:e,SubPermission:this.fb.array(t.SubMenu.map(n=>this.fb.group(Object.assign(n,{PermissionId:n.PermissionId,PermissionType:new K({value:n.PermissionType,disabled:!n.Checked})}))))})}getSubPermission(t,e){return t.get("SubPermission")}onSubmit(t){if(this.validateForm(),!this.roleForm.invalid){let e=this.createPayload(t);this.updateRole(e)}}validateForm(){Object.keys(this.roleForm.controls).forEach(t=>{this.setControlError(t)})}checkError(t,e){return this.roleForm.get(t)?.hasError(e)}getControlLabel(t){let e=Object.values(q).find(i=>i.NAME==t);return e?e.LABEL:t}getControl(t,e){return t.get(e)}setControlError(t){let e=this.getControl(this.roleForm,t);this.checkError(t,"required")?this.roleForm.get(t)?.setErrors(h(f({},e.errors),{invalid:`${this.getControlLabel(t)} is required`})):this.checkError(t,"permissionLength")?this.roleForm.get(t)?.setErrors(h(f({},e.errors),{invalid:`${this.getControlLabel(t)} is required, please select at least 1 permission`})):this.checkError(t,"maxlength")?this.roleForm.get(t)?.setErrors(h(f({},e.errors),{invalid:I.ROLE_NAME_LENGTH})):this.checkError(t,"pattern")&&this.roleForm.get(t)?.setErrors(h(f({},e.errors),{invalid:I.ALPHABETS_PATTERN}))}createPayload(t){let e=[],i=t;return[...this.roleForm.value.Permission].forEach(n=>{[...n.SubPermission].forEach(l=>{l.Checked&&e.push(l)})}),i.Permission=e,i}goBack(){this.router.navigate([x.MANAGE_ROLE])}updatePermission(t,e){t.get("Checked").setValue(e),e?(t.get("PermissionType").enable(),t.get("PermissionType").setValue(1)):(t.get("PermissionType").disable(),t.get("PermissionType").setValue(null))}onPermissionChange(t,e,i,n){switch(e){case"MAIN":i.get("SubPermission").controls.forEach(l=>{this.updatePermission(l,t.target.checked)});break;case"SUB":{let l=i.get("SubPermission");i.get("Checked").setValue(![...l.value].some(_=>!_.Checked)),this.updatePermission(l.at(n),t.target.checked);break}default:break}}updateRole(t){let e=`${S.UPDATE_ROLE}/${this.RoleId}`;this.commonService.put(e,t).pipe(v(this.destroy$)).subscribe({next:i=>{this.router.navigate([x.MANAGE_ROLE]),this.toasterService.showToast("success",i.message)},error:i=>{}})}static \u0275fac=function(e){return new(e||r)(u(B),u(se),u(oe),u(ie),u(ce),u(V))};static \u0275cmp=T({type:r,selectors:[["app-edit-roles"]],viewQuery:function(e,i){if(e&1&&N(_e,7),e&2){let n;L(n=A())&&(i.additionalColumn=n.first)}},decls:11,vars:3,consts:[["additionalColumn",""],[1,"rd-container"],[1,"rd-container-header"],[1,"rd-container-header-left"],[3,"url"],[1,"rd-heading","rd-heading-lg"],[4,"ngIf"],[3,"formSubmit","formCancel","fields","columns","additionalColumn","additionalForm"],["type","user-form"],[3,"formGroup"],["for","permission",4,"ngIf"],["id","permission-table","class","permission-table",4,"ngIf"],["for","permission"],[1,"required-asterik"],["id","permission-table",1,"permission-table"],["class","error-msg",4,"ngIf"],["colspan","2"],["formArrayName","Permission"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"error-msg"],[3,"formGroupName"],[1,"role-heading"],[1,"checkbox-input"],["type","checkbox","name","PermissionId","formControlName","Checked",3,"change","id"],["colspan","4"],[1,"rd-heading","rd-heading-xs-bold"],["formArrayName","SubPermission"],[3,"for"],[1,"radio-input"],["type","radio","formControlName","PermissionType",3,"value"],["class","radio-input",4,"ngIf"]],template:function(e,i){e&1&&(o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div"),g(4,"back-button",4),s(),o(5,"div",5),c(6,"Edit Role"),s()()(),p(7,fe,2,1,"div",6)(8,he,2,0,"div",6),s(),p(9,xe,3,3,"ng-template",null,0,D)),e&2&&(a(4),m("url",i.rolelistUrl),a(3),m("ngIf",i.isLoaded),a(),m("ngIf",!i.isLoaded))},dependencies:[G,j,$,ne,W,H,Q,X,z,J,re,Y,te,Z,ee,me,de,le],styles:[".form-container[_ngcontent-%COMP%]{width:800px}.role-list[_ngcontent-%COMP%]{animation:fadeIn .3s}.permission-table[_ngcontent-%COMP%]{width:100%;margin-top:10px}table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:5px;text-align:center}table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(2){text-align:left}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px}table[_ngcontent-%COMP%], th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border-bottom:1px solid #f2f2f2;border-collapse:collapse}table[_ngcontent-%COMP%]   .checkbox-input[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   .radio-input[_ngcontent-%COMP%]{justify-content:center}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2)   .checkbox-input[_ngcontent-%COMP%]{justify-content:left}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.role-heading[_ngcontent-%COMP%]{background-color:#f9fafb}"]})};export{pe as EditRolesComponent};
