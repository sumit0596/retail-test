import{a as O}from"./chunk-CYK5HLCI.js";import{a as k}from"./chunk-FJTDMGYD.js";import{a as $}from"./chunk-F2AWUHRW.js";import{a as P}from"./chunk-6ZT7OVEF.js";import{c as B}from"./chunk-5DBK4ZXR.js";import"./chunk-7IPKTMG7.js";import"./chunk-23ETMDCW.js";import"./chunk-FQU4EXR4.js";import"./chunk-7GNHLM6X.js";import{$ as N,ba as F}from"./chunk-FLJC444F.js";import{e as y,f as S,g as u,o as D}from"./chunk-IPZIKDLO.js";import{n as j,p as w}from"./chunk-TBJJFKUM.js";import{Fc as L,Gb as a,Qb as d,Rb as l,Sb as h,V as b,Wb as U,Yb as x,Z as m,Zb as c,ad as T,g as p,ia as E,ib as s,jc as R,kd as A,m as C,nb as n,qa as f,ra as v,ub as I,zb as _}from"./chunk-4KZPWME3.js";function M(o,t){if(o&1){let e=U();d(0,"div")(1,"app-dynamic-form",6),x("formSubmit",function(r){f(e);let g=c();return v(g.onSubmit(r))})("formCancel",function(){f(e);let r=c();return v(r.cancelUser())}),l()()}if(o&2){let e=c();s(),a("fields",e.fields)("columns",e.editColumns)("submitButtonText","Save & update")("cancelButtonText","Cancel")("flexiWidth",!0)}}function q(o,t){if(o&1&&(d(0,"div"),h(1,"app-skeleton-loader",7),l()),o&2){let e=c();s(),a("type",e.hasPageBuilderField()?"user-form-page-builder":"user-form")}}var V=class o{constructor(t,e,i,r,g,G,H){this.route=t;this.router=e;this.listingService=i;this.commonService=r;this.toasterService=g;this.commonStore=G;this.cdr=H}editColumns;roleId;PropertyIdVal=[];userInfo;userId;formConfig;roleList$;roleList;destroySubject=new C;userStore=E(D);userDetails;userlistUrl="admin/manage-users";fields=[{type:"text",label:"First Name",name:"FirstName",placeholder:"Enter First Name",value:"",wrapperClass:"col-12 col-md-6",validators:{required:!0,pattern:u.ALPHABETS,maxLength:100,whitespace:!0},id:"firstname"},{type:"text",label:"Last Name",name:"LastName",placeholder:"Enter Last Name",value:"",wrapperClass:"col-12 col-md-6",validators:{required:!0,pattern:u.ALPHABETS,maxLength:100,whitespace:!0},id:"lastname"},{type:"email",label:"Email",name:"Email",placeholder:"Enter Email Address",value:"",wrapperClass:"col-12 col-md-6",id:"email",validators:{required:!0,email:!0}},{type:"tel",label:"Cell number",name:"CellNumber",placeholder:"Enter contact number",value:"",wrapperClass:"col-12 col-md-6",id:"cellnumber",validators:{required:!0,pattern:u.NUMERIC_PLUS_SPACE_PATTERN}},{type:"select",label:"Roles",name:"RoleId",bindLabel:"Name",bindValue:"Id",value:"",options:this.roleList,id:"roles",validators:{required:!0},wrapperClass:"col-12 col-md-6",placeholder:"Select Role"}];ngOnInit(){this.configureForm()}configureForm(){return p(this,null,function*(){this.formConfig=yield this.commonStore.getFormConfig(),this.formConfig.id&&(this.userId=this.formConfig.id,this.getRoles().then(()=>this.getUserById()))})}getRoles(){return p(this,null,function*(){return this.roleList&&this.roleList.length>0?this.roleList:(this.roleList$=yield this.listingService.getRoles(),this.roleList$.pipe(m(this.destroySubject),b(1)).subscribe({next:t=>{this.roleList=t,this.fields.forEach(e=>{e.type=="select"&&e.name=="RoleId"&&(e.options=this.roleList)})},error:t=>{this.toasterService.error(t.error.message)}}),this.roleList)})}getUserById(){let t=`${S.USER_DETAIL}/${this.userId}`;this.commonService.get(t).pipe(m(this.destroySubject)).subscribe({next:e=>{this.userDetails=e.data,this.roleId=this.userDetails.RoleId,this.fields.forEach(i=>{i.type==="select"&&i.name==="RoleId"&&(i.options=this.roleList),i.name==="Email"&&(i.disabled=!0),i.value=this.userDetails[i.name]??""}),this.editColumns=[{value:this.fields}],this.cdr.markForCheck()},error:e=>{}})}updateUser(t){return p(this,null,function*(){let e=`${S.UPDATE_USER}/${this.userId}`;t.Status??=0,(yield this.userStore.getUser()).pipe(m(this.destroySubject)).subscribe({next:r=>{this.userInfo=r}}),this.commonService.put(e,t).pipe(m(this.destroySubject)).subscribe({next:r=>{r.data.UserId===this.userInfo.UserId&&this.userStore.setUser(r.data),this.router.navigateByUrl(`${y.MANAGE_USER}`).then(()=>{this.toasterService.success(r.message)})},error:r=>{}})})}onSubmit(t){this.updateUser(t)}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}cancelUser(){this.router.navigate([`${y.MANAGE_USER}`])}hasPageBuilderField(){return this.fields?.some(t=>t.type==="pagebuilder")??!1}static \u0275fac=function(e){return new(e||o)(n(j),n(w),n(O),n(F),n(N),n(k),n(L))};static \u0275cmp=I({type:o,selectors:[["app-edit-user"]],decls:9,vars:3,consts:[[1,"rd-container"],[1,"rd-container-header"],[1,"rd-container-header-left"],[3,"url"],[1,"rd-heading","rd-heading-lg"],[4,"ngIf"],[3,"formSubmit","formCancel","fields","columns","submitButtonText","cancelButtonText","flexiWidth"],[3,"type"]],template:function(e,i){e&1&&(d(0,"div",0)(1,"div",1)(2,"div",2)(3,"div"),h(4,"back-button",3),l(),d(5,"div",4),R(6,"Edit User"),l()()(),_(7,M,2,5,"div",5)(8,q,2,1,"div",5),l()),e&2&&(s(4),a("url",i.userlistUrl),s(3),a("ngIf",i.editColumns),s(),a("ngIf",!i.editColumns))},dependencies:[B,A,T,$,P],encapsulation:2})};export{V as EditUserComponent};
