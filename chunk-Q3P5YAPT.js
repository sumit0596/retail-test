import{a as de}from"./chunk-F2AWUHRW.js";import{a as ce}from"./chunk-6ZT7OVEF.js";import{b as le,c as me}from"./chunk-5DBK4ZXR.js";import"./chunk-7IPKTMG7.js";import"./chunk-23ETMDCW.js";import{b as Q,c as H,g as z,h as J,k as K,m as W,n as X,o as Y,p as Z,q as ee,r as te,u as ie,v as re,w as ne}from"./chunk-FQU4EXR4.js";import"./chunk-7GNHLM6X.js";import{$ as oe,ba as se}from"./chunk-FLJC444F.js";import{a as F,b as q,e as O,f as R,g as U,r as ae}from"./chunk-IPZIKDLO.js";import{p as $}from"./chunk-TBJJFKUM.js";import{$c as j,Ac as V,Fc as D,Gb as l,Qb as o,Rb as a,Sb as g,Tb as E,Ub as N,Wb as b,Yb as v,Z as S,Zb as c,a as f,ad as B,b as h,dc as I,ec as L,fc as A,g as k,ib as s,ic as w,jc as d,kc as P,kd as G,m as M,nb as _,qa as C,ra as y,ub as T,zb as u}from"./chunk-4KZPWME3.js";var _e=["nameCell"];function ge(n,t){if(n&1){let e=b();o(0,"div")(1,"app-dynamic-form",7),v("formSubmit",function(r){C(e);let m=c();return y(m.onSubmit(r))})("formCancel",function(){C(e);let r=c();return y(r.goBack())}),a()()}if(n&2){let e=c(),i=w(11);s(),l("fields",e.fields)("columns",e.createcolumns)("submitButtonText","Create Role")("additionalColumn",i)("additionalForm",e.roleForm)}}function fe(n,t){n&1&&(o(0,"div"),g(1,"app-skeleton-loader",8),a())}function he(n,t){if(n&1&&(o(0,"div",18)(1,"small"),d(2),a()()),n&2){let e=c(3);s(2),P(e.permissions.errors==null?null:e.permissions.errors.invalid)}}function Ce(n,t){n&1&&(o(0,"div",27),g(1,"input",28),a()),n&2&&(s(),l("value",0))}function ye(n,t){if(n&1){let e=b();o(0,"tr",19)(1,"td",15)(2,"div",21)(3,"input",22),v("change",function(r){let m=C(e).index,p=c().$implicit,x=c(3);return y(x.onPermissionChange(r,"SUB",p,m))}),a()()(),o(4,"td")(5,"label",26),d(6),a()(),o(7,"td")(8,"div",27),g(9,"input",28),a()(),o(10,"td"),u(11,Ce,2,1,"div",29),a()()}if(n&2){let e=t.$implicit,i=t.index,r=c().index,m=c(3);l("formGroupName",i),s(3),l("id","sub-permission-id"+r+i),s(2),l("for","sub-permission-id"+r+i),s(),P(e.value.Name),s(3),l("value",1),s(2),l("ngIf",m.mergedPermissionList[r].Name!="Dashboard")}}function be(n,t){if(n&1){let e=b();E(0,19),o(1,"tr",20)(2,"td")(3,"div",21)(4,"input",22),v("change",function(r){let m=C(e),p=m.$implicit,x=m.index,ue=c(3);return y(ue.onPermissionChange(r,"MAIN",p,x))}),a()()(),o(5,"td",23)(6,"label",24),d(7),a()()(),E(8,25),u(9,ye,12,6,"tr",17),N()()}if(n&2){let e=t.$implicit,i=t.index,r=c(3);l("formGroupName",i),s(4),l("id","permission-id"+i),s(3),P(r.mergedPermissionList[i].Name),s(2),l("ngForOf",r.getSubPermission(e,i).controls)}}function ve(n,t){if(n&1&&(o(0,"table",13)(1,"caption"),u(2,he,3,1,"div",14),a(),o(3,"thead"),g(4,"th",15),o(5,"th"),d(6,"Permission"),a(),o(7,"th"),d(8,"Full Access"),a(),o(9,"th"),d(10,"Readonly"),a()(),o(11,"tbody",16),u(12,be,10,4,"ng-container",17),a()()),n&2){let e=c(2);s(2),l("ngIf",e.permissions==null?null:e.permissions.hasError("invalid")),s(10),l("ngForOf",e.permissions.controls)}}function Pe(n,t){if(n&1&&(o(0,"form",9)(1,"label",10),d(2,"Select Permissions "),o(3,"span",11),d(4,"*"),a()(),u(5,ve,13,2,"table",12),a()),n&2){let e=c();l("formGroup",e.roleForm),s(5),l("ngIf",e.mergedPermissionList.length)}}var pe=class n{constructor(t,e,i,r,m,p){this.router=t;this.loaderService=e;this.toasterService=i;this.fb=r;this.commonService=m;this.cdr=p}formConfig;loadingSkeleton=!0;roleForm;permissionList=[];selectedPermissionList=[];mergedPermissionList=[];role;selectedCheckBox=0;selectedPermission=[];createcolumns=[];fields=[];additionalColumn;destroy$=new M;rolelistUrl=O.MANAGE_ROLE;ngOnInit(){this.roleForm=this.fb.group({Permission:this.fb.array([],le.permissionValidator)}),this.getPermissions()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}get permissions(){return this.roleForm.get("Permission")}getPermissions(){return k(this,null,function*(){this.loadingSkeleton=!0,this.commonService.get(`${R.PERMISSION_LIST}`).pipe(S(this.destroy$)).subscribe({next:t=>{let e=t.data;if(e.length>0){let i=e[0].SubMenu.slice(0,1);e[0].SubMenu=i}this.permissionList=e,this.bindPermission(),this.fields=[{type:"text",label:"Name",name:"Name",value:"",id:"Name",wrapperClass:"col-md-12",disabled:!1,placeholder:"Enter First Name",validators:{required:!0,pattern:U.ALPHABETS,maxLength:100,whitespace:!0}},{type:"textarea",label:"Description",name:"Description",value:"",id:"Description",wrapperClass:"col-md-12",disabled:!1,placeholder:"Enter Description",required:!0,validators:{required:!0,whitespace:!0}},{type:"hidden",name:"Permission",label:"",value:this.roleForm.value.Permission}],this.createcolumns=[{id:"col-12 d-flex flex-wrap gap-3 justify-content-center",value:this.fields}],this.cdr.markForCheck(),this.loadingSkeleton=!1},error:t=>{this.loadingSkeleton=!1}})})}bindPermission(){this.mergedPermissionList=this.permissionList.map(t=>([...t.SubMenu].forEach(e=>{let i=this.selectedPermissionList.find(r=>r.PermissionId==e.PermissionId);i?Object.assign(e,{Checked:i.Checked,PermissionType:i.PermissionType}):Object.assign(e,{Checked:!1,PermissionType:""})}),t)),this.mergedPermissionList.forEach(t=>{this.permissions.push(this.createPermissionForm(t))})}createPermissionForm(t){let e=[...t.SubMenu].every(r=>r.Checked);return this.fb.group({Name:[t.Name],Checked:e,SubPermission:this.fb.array(t.SubMenu.map(r=>this.fb.group(Object.assign(r,{PermissionId:r.PermissionId,PermissionType:new K({value:r.PermissionType,disabled:!r.Checked})}))))})}getSubPermission(t,e){return t.get("SubPermission")}onSubmit(t){if(this.validateForm(),!this.roleForm.invalid){let e=this.createPayload(t);this.createRole(e)}}validateForm(){Object.keys(this.roleForm.controls).forEach(t=>{this.setControlError(t)})}checkError(t,e){return this.roleForm.get(t)?.hasError(e)}getControlLabel(t){let e=Object.values(q).find(i=>i.NAME==t);return e?e.LABEL:t}getControl(t,e){return t.get(e)}setControlError(t){let e=this.getControl(this.roleForm,t);this.checkError(t,"required")?this.roleForm.get(t)?.setErrors(h(f({},e.errors),{invalid:`${this.getControlLabel(t)} is required`})):this.checkError(t,"permissionLength")?this.roleForm.get(t)?.setErrors(h(f({},e.errors),{invalid:`${this.getControlLabel(t)} is required, please select at least 1 permission`})):this.checkError(t,"maxlength")?this.roleForm.get(t)?.setErrors(h(f({},e.errors),{invalid:F.ROLE_NAME_LENGTH})):this.checkError(t,"pattern")&&this.roleForm.get(t)?.setErrors(h(f({},e.errors),{invalid:F.ALPHABETS_PATTERN}))}createPayload(t){this.selectedPermission=[];let e=t;return[...this.roleForm.value.Permission].forEach(i=>{[...i.SubPermission].forEach(r=>{r.Checked&&this.selectedPermission.push(r)})}),e.Permission=this.selectedPermission,e}goBack(){this.router.navigate([O.MANAGE_ROLE])}createRole(t){this.commonService.post(`${R.ADD_ROLE}`,t).pipe(S(this.destroy$)).subscribe({next:e=>{this.toasterService.success(e.message),this.goBack()},error:e=>{}})}updatePermission(t,e){t.get("Checked").setValue(e),e?(t.get("PermissionType").enable(),t.get("PermissionType").setValue(1)):(t.get("PermissionType").disable(),t.get("PermissionType").setValue(null))}onPermissionChange(t,e,i,r){let m;switch(e){case"MAIN":i.get("SubPermission").controls.forEach(p=>{this.updatePermission(p,t.target.checked)});break;case"SUB":m=i.get("SubPermission"),i.get("Checked").setValue(![...m.value].some(p=>!p.Checked)),this.updatePermission(m.at(r),t.target.checked);break;default:break}}static \u0275fac=function(e){return new(e||n)(_($),_(ae),_(oe),_(ie),_(se),_(D))};static \u0275cmp=T({type:n,selectors:[["app-create-role"]],viewQuery:function(e,i){if(e&1&&I(_e,7),e&2){let r;L(r=A())&&(i.additionalColumn=r.first)}},decls:12,vars:3,consts:[["additionalColumn",""],[1,"rd-container"],[1,"rd-container-header"],[1,"rd-container-header-left"],[3,"url"],[1,"rd-heading","rd-heading-lg"],[4,"ngIf"],[3,"formSubmit","formCancel","fields","columns","submitButtonText","additionalColumn","additionalForm"],["type","user-form"],[3,"formGroup"],["for","permission"],[1,"required-asterik"],["id","permission-table","class","permission-table",4,"ngIf"],["id","permission-table",1,"permission-table"],["class","error-msg",4,"ngIf"],["colspan","2"],["formArrayName","Permission"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"error-msg"],[3,"formGroupName"],[1,"role-heading"],[1,"checkbox-input"],["type","checkbox","name","PermissionId","formControlName","Checked",3,"change","id"],["colspan","4"],[1,"rd-heading","rd-heading-xs-bold"],["formArrayName","SubPermission"],[3,"for"],[1,"radio-input"],["type","radio","formControlName","PermissionType",3,"value"],["class","radio-input",4,"ngIf"]],template:function(e,i){e&1&&(o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div"),g(4,"back-button",4),a(),o(5,"div",5),d(6,"Create Role"),a()()(),o(7,"div"),u(8,ge,2,5,"div",6)(9,fe,2,0,"div",6),a()(),u(10,Pe,6,2,"ng-template",null,0,V)),e&2&&(s(4),l("url",i.rolelistUrl),s(4),l("ngIf",!i.loadingSkeleton&&i.fields.length>0),s(),l("ngIf",i.loadingSkeleton&&!i.fields.length))},dependencies:[G,j,B,re,W,H,Q,X,z,J,ne,Y,te,Z,ee,me,de,ce],styles:[".form-container[_ngcontent-%COMP%]{width:800px}.role-list[_ngcontent-%COMP%]{animation:fadeIn .3s}.permission-table[_ngcontent-%COMP%]{width:100%;margin-top:10px}table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:5px;text-align:center}table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(2){text-align:left}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px}table[_ngcontent-%COMP%], th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border-bottom:1px solid #f2f2f2;border-collapse:collapse}table[_ngcontent-%COMP%]   .checkbox-input[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   .radio-input[_ngcontent-%COMP%]{justify-content:center}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2)   .checkbox-input[_ngcontent-%COMP%]{justify-content:left}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.role-heading[_ngcontent-%COMP%]{background-color:#f9fafb}"]})};export{pe as CreateRoleComponent};
